<!DOCTYPE html>
<html>
<head>
    <title>bureau.io MVP</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcomeScreen" style="text-align: center; padding: 50px;">
        <h1>Welcome to bureau.io!</h1>
        <button class="button" id="getStartedBtn">Get Started</button>
    </div>

    <!-- Auth Form -->
    <div id="authForm" style="display:none; text-align: center; padding: 50px;">
        <h2>Sign Up / Log In</h2>
        <input type="text" id="username" placeholder="Enter your username"><br><br>
        <input type="password" id="password" placeholder="Enter your password"><br><br>
        <button class="button" id="signUpBtn">Sign Up</button>
        <button class="button" id="logInBtn">Log In</button>
    </div>

    <!-- Main Chat Interface (hidden at first) -->
    <div id="chatInterface" style="display:none; height: 100vh; display: flex;">
        <!-- Sidebar -->
        <div id="sidebar" style="width: 250px; background: #2f3136; color: white; padding: 20px;">
            <h3 style="margin-top: 0; color: #dcddde;">bureau.io</h3>
            
            <!-- User Info -->
            <div style="margin-bottom: 30px; padding: 10px; background: #40444b; border-radius: 5px;">
                <div style="font-weight: bold; color: #dcddde;">ðŸ‘¤ <span id="userDisplayName">User</span></div>
                <div style="font-size: 12px; color: #72767d;">Online</div>
            </div>
            
            <!-- Room List -->
            <div style="margin-bottom: 20px;">
                <h4 style="color: #72767d; font-size: 12px; text-transform: uppercase; margin-bottom: 10px;">Chat Rooms</h4>
                <div id="roomList">
                    <div class="room-item active" data-room="general"># General</div>
                    <div class="room-item" data-room="random"># Random</div>
                    <div class="room-item" data-room="help"># Help</div>
                    <div class="room-item" data-room="gaming"># Gaming</div>
                </div>
            </div>
            
            <!-- Online Users -->
            <div>
                <h4 style="color: #72767d; font-size: 12px; text-transform: uppercase; margin-bottom: 10px;">Online Users</h4>
                <div id="onlineUsers">
                    <div style="color: #72767d; font-size: 12px;">No users online</div>
                </div>
            </div>
        </div>
        
        <!-- Chat Area -->
        <div id="chatArea" style="flex: 1; display: flex; flex-direction: column; background: #36393f;">
            <!-- Chat Header -->
            <div style="padding: 20px; border-bottom: 1px solid #40444b; background: #36393f;">
                <h2 style="margin: 0; color: #dcddde;"># <span id="currentRoomName">General</span></h2>
            </div>
            
            <!-- Messages -->
            <div id="chatMessages" style="flex: 1; padding: 20px; overflow-y: auto; background: #36393f;"></div>
            
            <!-- Message Input -->
            <div style="padding: 20px; background: #36393f; border-top: 1px solid #40444b;">
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="chatInput" placeholder="Type a message..." style="flex: 1; padding: 12px; border: none; border-radius: 5px; background: #40444b; color: #dcddde;">
                    <button class="button" id="sendBtn">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Connect to the server
        const socket = io();

        // Store the username and current room
        let currentUsername = "";
        let currentRoom = "general";

        // When you sign up or log in, show the chat room and set the username
        function showChatRoom(username) {
            currentUsername = username;
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('authForm').style.display = 'none';
            document.getElementById('chatInterface').style.display = 'flex';
            
            // Update user display name
            document.getElementById('userDisplayName').textContent = username;
            
            // Join the default room
            joinRoom("general");
        }

        // Function to join a room
        function joinRoom(roomName) {
            // Leave current room
            socket.emit('leave room', currentRoom);
            
            // Join new room
            currentRoom = roomName;
            socket.emit('join room', roomName);
            
            // Update UI
            document.getElementById('currentRoomName').textContent = roomName.charAt(0).toUpperCase() + roomName.slice(1);
            document.getElementById('chatMessages').innerHTML = `<em style="color: #72767d;">Joined <b># ${roomName}</b>. Start chatting!</em><br>`;
            
            // Update room selection
            document.querySelectorAll('.room-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-room="${roomName}"]`).classList.add('active');
        }

        // When you send a message
        document.getElementById('sendBtn').onclick = function() {
            var input = document.getElementById('chatInput');
            var message = input.value.trim();
            if (message === "") return;

            // Get the current time
            var now = new Date();
            var hours = now.getHours().toString().padStart(2, '0');
            var minutes = now.getMinutes().toString().padStart(2, '0');
            var timestamp = hours + ":" + minutes;

            // Send the message to the current room
            socket.emit('chat message', {
                message: `<b>${currentUsername}:</b> ${message} <span style="color:#72767d; font-size:0.9em;">[${timestamp}]</span>`,
                room: currentRoom
            });

            input.value = "";
        };

        // When a message is received from the server
        socket.on('chat message', function(data) {
            var chatBox = document.getElementById('chatMessages');
            chatBox.innerHTML += `<div style="margin-bottom: 10px; color: #dcddde;">${data.message}</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        // Handle room clicks
        document.querySelectorAll('.room-item').forEach(item => {
            item.addEventListener('click', function() {
                var selectedRoom = this.getAttribute('data-room');
                joinRoom(selectedRoom);
            });
        });

        // Allow pressing Enter to send message
        document.getElementById('chatInput').addEventListener('keydown', function(e) {
            if (e.key === "Enter") {
                document.getElementById('sendBtn').click();
            }
        });

        // Update your sign up and log in button handlers to use showChatRoom(username)
        document.getElementById('signUpBtn').onclick = function() {
            var username = document.getElementById('username').value.trim();
            if (username === "") {
                alert("Please enter a username");
                return;
            }
            showChatRoom(username);
        };

        document.getElementById('logInBtn').onclick = function() {
            var username = document.getElementById('username').value;
            if (username.trim() === "") {
                alert("Please enter a username.");
                return;
            }
            showChatRoom(username);
        };

        // Show the form when "Get Started" is clicked
        document.getElementById('getStartedBtn').onclick = function() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('authForm').style.display = 'block';
        };
    </script>
</body>
</html>
    